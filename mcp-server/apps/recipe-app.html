<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Chef</title>
  <style>
    /* Base reset */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* Colors */
    :root {
      --orange-50: #fff7ed; --orange-100: #ffedd5; --orange-500: #f97316; --orange-600: #ea580c; --orange-700: #c2410c;
      --green-50: #f0fdf4; --green-100: #dcfce7; --green-500: #22c55e; --green-600: #16a34a;
      --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb; --gray-300: #d1d5db;
      --gray-400: #9ca3af; --gray-500: #6b7280; --gray-600: #4b5563; --gray-700: #374151; --gray-800: #1f2937;
      --blue-50: #eff6ff; --blue-500: #3b82f6; --blue-600: #2563eb;
      --red-50: #fef2f2; --red-500: #ef4444;
      --yellow-500: #eab308;
    }

    body { font-family: system-ui, -apple-system, sans-serif; background: var(--gray-50); color: var(--gray-800); line-height: 1.5; }

    /* Layout utilities */
    .hidden { display: none !important; }
    .flex { display: flex; }
    .flex-wrap { flex-wrap: wrap; }
    .flex-1 { flex: 1 1 0%; }
    .items-center { align-items: center; }
    .items-start { align-items: flex-start; }
    .justify-between { justify-content: space-between; }
    .justify-center { justify-content: center; }
    .gap-1 { gap: 0.25rem; }
    .gap-2 { gap: 0.5rem; }
    .gap-3 { gap: 0.75rem; }
    .gap-4 { gap: 1rem; }
    .grid { display: grid; }
    .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }

    /* Spacing */
    .p-2 { padding: 0.5rem; } .p-3 { padding: 0.75rem; } .p-4 { padding: 1rem; }
    .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
    .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
    .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
    .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
    .mb-1 { margin-bottom: 0.25rem; } .mb-2 { margin-bottom: 0.5rem; } .mb-3 { margin-bottom: 0.75rem; } .mb-4 { margin-bottom: 1rem; }
    .mr-1 { margin-right: 0.25rem; } .mr-2 { margin-right: 0.5rem; }
    .mt-1 { margin-top: 0.25rem; } .mt-2 { margin-top: 0.5rem; } .mt-3 { margin-top: 0.75rem; } .mt-4 { margin-top: 1rem; }
    .mx-auto { margin-left: auto; margin-right: auto; }

    /* Sizing */
    .w-full { width: 100%; }
    .min-w-0 { min-width: 0; }

    /* Typography */
    .text-xs { font-size: 0.75rem; } .text-sm { font-size: 0.875rem; } .text-base { font-size: 1rem; }
    .text-lg { font-size: 1.125rem; } .text-xl { font-size: 1.25rem; } .text-2xl { font-size: 1.5rem; }
    .text-3xl { font-size: 1.875rem; } .text-4xl { font-size: 2.25rem; }
    .font-medium { font-weight: 500; } .font-semibold { font-weight: 600; } .font-bold { font-weight: 700; }
    .text-center { text-align: center; }
    .text-gray-400 { color: var(--gray-400); } .text-gray-500 { color: var(--gray-500); }
    .text-gray-600 { color: var(--gray-600); } .text-gray-700 { color: var(--gray-700); } .text-gray-800 { color: var(--gray-800); }
    .text-orange-600 { color: var(--orange-600); } .text-orange-700 { color: var(--orange-700); }
    .text-green-600 { color: var(--green-600); }
    .line-through { text-decoration: line-through; }

    /* Backgrounds */
    .bg-white { background: white; }
    .bg-gray-50 { background: var(--gray-50); } .bg-gray-100 { background: var(--gray-100); }
    .bg-orange-50 { background: var(--orange-50); } .bg-orange-100 { background: var(--orange-100); }
    .bg-orange-500 { background: var(--orange-500); } .bg-orange-600 { background: var(--orange-600); }
    .bg-green-50 { background: var(--green-50); } .bg-green-100 { background: var(--green-100); }
    .bg-green-500 { background: var(--green-500); }
    .bg-blue-50 { background: var(--blue-50); }

    /* Borders & Radius */
    .border { border: 1px solid var(--gray-200); }
    .border-b { border-bottom: 1px solid var(--gray-200); }
    .border-orange-200 { border-color: #fed7aa; }
    .border-green-200 { border-color: #bbf7d0; }
    .rounded { border-radius: 0.25rem; } .rounded-lg { border-radius: 0.5rem; } .rounded-xl { border-radius: 0.75rem; }
    .rounded-full { border-radius: 9999px; }
    .overflow-hidden { overflow: hidden; }

    /* Shadows */
    .shadow-sm { box-shadow: 0 1px 2px rgba(0,0,0,0.05); }

    /* Buttons */
    button { cursor: pointer; border: none; font: inherit; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 500; transition: all 0.2s; }
    .btn-primary { background: var(--orange-600); color: white; }
    .btn-primary:hover:not(:disabled) { background: var(--orange-700); }
    .btn-outline { background: white; border: 1px solid var(--gray-300); color: var(--gray-700); }
    .btn-outline:hover:not(:disabled) { background: var(--gray-50); }
    .btn-sm { padding: 0.25rem 0.5rem; font-size: 0.875rem; }
    .btn-icon { width: 2rem; height: 2rem; padding: 0; display: flex; align-items: center; justify-content: center; border-radius: 0.5rem; }

    /* Animations */
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pop-in { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    @keyframes check-bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
    .animate-spin { animation: spin 1s linear infinite; }
    .check-animate { animation: pop-in 0.3s ease; }

    /* Recipe header */
    .recipe-header { background: linear-gradient(135deg, var(--orange-50), var(--orange-100)); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem; }
    .recipe-icon { font-size: 3rem; line-height: 1; }
    .recipe-meta { display: flex; gap: 0.75rem; flex-wrap: wrap; }
    .meta-item { display: flex; align-items: center; gap: 0.25rem; font-size: 0.75rem; color: var(--gray-600); background: white; padding: 0.25rem 0.5rem; border-radius: 9999px; }

    /* Section headers */
    .section-header { font-size: 0.875rem; font-weight: 600; color: var(--gray-700); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }

    /* Ingredients list */
    .ingredient-item { display: flex; align-items: flex-start; gap: 0.5rem; padding: 0.5rem 0; border-bottom: 1px solid var(--gray-100); cursor: pointer; transition: all 0.2s; }
    .ingredient-item:last-child { border-bottom: none; }
    .ingredient-item:hover { background: var(--gray-50); margin: 0 -0.5rem; padding-left: 0.5rem; padding-right: 0.5rem; border-radius: 0.25rem; }
    .ingredient-item.checked .ingredient-text { text-decoration: line-through; color: var(--gray-400); }
    .ingredient-checkbox { width: 1.25rem; height: 1.25rem; border: 2px solid var(--gray-300); border-radius: 0.25rem; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; margin-top: 0.125rem; }
    .ingredient-item.checked .ingredient-checkbox { background: var(--green-500); border-color: var(--green-500); color: white; }
    .ingredient-amount { font-weight: 500; color: var(--gray-700); min-width: 3.5rem; }
    .ingredient-text { flex: 1; }
    .optional-badge { font-size: 0.625rem; background: var(--gray-200); color: var(--gray-600); padding: 0.125rem 0.375rem; border-radius: 9999px; margin-left: 0.5rem; }

    /* Steps list */
    .step-item { display: flex; gap: 0.75rem; padding: 0.75rem 0; border-bottom: 1px solid var(--gray-100); }
    .step-item:last-child { border-bottom: none; }
    .step-number { width: 1.5rem; height: 1.5rem; background: var(--orange-500); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 600; flex-shrink: 0; }
    .step-content { flex: 1; }
    .step-time { font-size: 0.75rem; color: var(--gray-500); margin-top: 0.25rem; }

    /* Nutrition panel */
    .nutrition-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }
    .nutrition-item { background: var(--gray-50); padding: 0.5rem; border-radius: 0.5rem; text-align: center; }
    .nutrition-value { font-size: 1.125rem; font-weight: 600; color: var(--gray-800); }
    .nutrition-label { font-size: 0.625rem; color: var(--gray-500); text-transform: uppercase; letter-spacing: 0.05em; }

    /* Serving adjuster */
    .serving-adjuster { display: flex; align-items: center; gap: 0.5rem; background: var(--blue-50); padding: 0.5rem 0.75rem; border-radius: 0.5rem; }
    .serving-count { font-size: 1.125rem; font-weight: 600; min-width: 2rem; text-align: center; }

    /* Tags */
    .tag { display: inline-flex; align-items: center; gap: 0.25rem; font-size: 0.625rem; padding: 0.125rem 0.5rem; border-radius: 9999px; background: var(--orange-100); color: var(--orange-700); }

    /* Difficulty badge */
    .difficulty-easy { background: var(--green-100); color: var(--green-600); }
    .difficulty-medium { background: var(--orange-100); color: var(--orange-600); }
    .difficulty-hard { background: var(--red-50); color: var(--red-500); }

    /* Card sections */
    .card { background: white; border-radius: 0.75rem; padding: 1rem; border: 1px solid var(--gray-200); margin-bottom: 0.75rem; }

    /* Focus states for accessibility */
    button:focus-visible { outline: 2px solid var(--orange-500); outline-offset: 2px; }
    .btn:focus-visible { box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2); }
    .btn:active:not(:disabled) { transform: scale(0.98); }
  </style>
</head>
<body>
  <div id="app" style="padding: 0.75rem; width: 100%;">
    <!-- Loading State -->
    <div id="loading" class="text-center py-8">
      <div class="text-4xl mb-4">üë®‚Äçüç≥</div>
      <div class="animate-spin mx-auto mb-4" style="width: 2rem; height: 2rem; border: 3px solid var(--gray-200); border-top-color: var(--orange-600); border-radius: 50%;"></div>
      <p class="text-gray-600 font-medium">Finding the perfect recipe...</p>
      <p class="text-gray-400 text-xs mt-1">Preparing something delicious üçΩÔ∏è</p>
    </div>

    <!-- Main Content (hidden until recipe loaded) -->
    <div id="content" class="hidden">
      <!-- Recipe Header -->
      <div class="recipe-header">
        <div class="flex items-start gap-3 mb-3">
          <span id="recipe-icon" class="recipe-icon">üçù</span>
          <div class="flex-1 min-w-0">
            <h1 id="recipe-name" class="text-lg font-bold text-gray-800 mb-1">Recipe Name</h1>
            <p id="recipe-description" class="text-sm text-gray-600 mb-2">Recipe description</p>
            <div class="recipe-meta">
              <span class="meta-item"><span>‚è±Ô∏è</span><span id="prep-time">0 min prep</span></span>
              <span class="meta-item"><span>üç≥</span><span id="cook-time">0 min cook</span></span>
              <span id="difficulty-badge" class="meta-item difficulty-easy">Easy</span>
            </div>
          </div>
        </div>
        <div id="tags-container" class="flex flex-wrap gap-1"></div>
      </div>

      <!-- Serving Adjuster -->
      <div class="card">
        <div class="flex items-center justify-between">
          <span class="text-sm font-medium text-gray-700">Servings</span>
          <div class="serving-adjuster">
            <button id="decrease-servings" class="btn-icon btn-outline">‚àí</button>
            <span id="serving-count" class="serving-count">4</span>
            <button id="increase-servings" class="btn-icon btn-outline">+</button>
          </div>
        </div>
      </div>

      <!-- Ingredients Section -->
      <div class="card">
        <div class="section-header">
          <span>ü•ó</span>
          <span>Ingredients</span>
          <span id="ingredients-progress" class="text-xs text-gray-400 font-normal ml-auto">0/0</span>
        </div>
        <div id="ingredients-list">
          <!-- Ingredients will be inserted here -->
        </div>
      </div>

      <!-- Steps Section -->
      <div class="card">
        <div class="section-header">
          <span>üìù</span>
          <span>Instructions</span>
        </div>
        <div id="steps-list">
          <!-- Steps will be inserted here -->
        </div>
      </div>

      <!-- Nutrition Section -->
      <div class="card">
        <div class="section-header">
          <span>üìä</span>
          <span>Nutrition (per serving)</span>
        </div>
        <div class="nutrition-grid">
          <div class="nutrition-item">
            <div id="calories" class="nutrition-value">0</div>
            <div class="nutrition-label">Calories</div>
          </div>
          <div class="nutrition-item">
            <div id="protein" class="nutrition-value">0g</div>
            <div class="nutrition-label">Protein</div>
          </div>
          <div class="nutrition-item">
            <div id="carbs" class="nutrition-value">0g</div>
            <div class="nutrition-label">Carbs</div>
          </div>
          <div class="nutrition-item">
            <div id="fat" class="nutrition-value">0g</div>
            <div class="nutrition-label">Fat</div>
          </div>
          <div class="nutrition-item">
            <div id="fiber" class="nutrition-value">0g</div>
            <div class="nutrition-label">Fiber</div>
          </div>
        </div>
      </div>

      <!-- Save Recipe Button -->
      <button id="save-recipe-btn" class="btn btn-primary w-full mt-3">
        <span class="mr-1">üíæ</span> Save Recipe
      </button>
    </div>
  </div>

  <script type="module">
    // MCP App Communication Module
    const mcpApp = (() => {
      let requestId = 1;
      const pendingRequests = new Map();

      // Send JSON-RPC request (expects response)
      function sendRequest(method, params) {
        const id = requestId++;
        return new Promise((resolve, reject) => {
          pendingRequests.set(id, { resolve, reject });
          window.parent.postMessage({ jsonrpc: "2.0", id, method, params }, "*");
        });
      }

      // Send JSON-RPC notification (no response expected)
      function sendNotification(method, params) {
        window.parent.postMessage({ jsonrpc: "2.0", method, params }, "*");
      }

      // Handle incoming messages
      window.addEventListener("message", (event) => {
        const data = event.data;
        if (!data || typeof data !== "object") return;

        // Handle response to our request
        if (data.id && pendingRequests.has(data.id)) {
          const { resolve, reject } = pendingRequests.get(data.id);
          pendingRequests.delete(data.id);
          if (data.error) {
            reject(data.error);
          } else {
            resolve(data.result);
          }
          return;
        }

        // Handle notifications from host
        if (data.method) {
          const handler = notificationHandlers[data.method];
          if (handler) handler(data.params);
        }
      });

      // Notification handlers
      const notificationHandlers = {};
      function onNotification(method, handler) {
        notificationHandlers[method] = handler;
      }

      // Report size changes - use scrollWidth/Height to measure content
      function reportSize() {
        const app = document.getElementById("app");
        sendNotification("ui/notifications/size-change", {
          width: Math.ceil(app.scrollWidth),
          height: Math.ceil(app.scrollHeight),
        });
      }

      return { sendRequest, sendNotification, onNotification, reportSize };
    })();

    // App State
    let recipe = null;
    let currentServings = 4;
    let originalServings = 4;
    let checkedIngredients = new Set();

    // DOM Elements
    const elements = {
      loading: document.getElementById("loading"),
      content: document.getElementById("content"),
      recipeIcon: document.getElementById("recipe-icon"),
      recipeName: document.getElementById("recipe-name"),
      recipeDescription: document.getElementById("recipe-description"),
      prepTime: document.getElementById("prep-time"),
      cookTime: document.getElementById("cook-time"),
      difficultyBadge: document.getElementById("difficulty-badge"),
      tagsContainer: document.getElementById("tags-container"),
      servingCount: document.getElementById("serving-count"),
      decreaseServings: document.getElementById("decrease-servings"),
      increaseServings: document.getElementById("increase-servings"),
      ingredientsList: document.getElementById("ingredients-list"),
      ingredientsProgress: document.getElementById("ingredients-progress"),
      stepsList: document.getElementById("steps-list"),
      calories: document.getElementById("calories"),
      protein: document.getElementById("protein"),
      carbs: document.getElementById("carbs"),
      fat: document.getElementById("fat"),
      fiber: document.getElementById("fiber"),
      saveRecipeBtn: document.getElementById("save-recipe-btn"),
    };

    // Initialize the app
    async function initialize() {
      try {
        // Initialize MCP connection
        await mcpApp.sendRequest("ui/initialize", {
          protocolVersion: "2025-06-18",
          appInfo: { name: "Recipe Chef", version: "1.0.0" },
          appCapabilities: {},
        });

        // Notify host we're ready
        mcpApp.sendNotification("ui/notifications/initialized", {});

        // Setup resize observer on content
        const resizeObserver = new ResizeObserver(() => mcpApp.reportSize());
        resizeObserver.observe(document.getElementById("app"));
      } catch (error) {
        console.error("Failed to initialize:", error);
      }
    }

    // Handle tool result notification (recipe data)
    mcpApp.onNotification("ui/notifications/tool-result", (params) => {
      const result = params?.structuredContent;
      if (result?.recipe) {
        recipe = result.recipe;
        currentServings = recipe.servings;
        originalServings = recipe.servings;
        checkedIngredients.clear();
        renderRecipe();
      }
    });

    // Handle tool input notification
    mcpApp.onNotification("ui/notifications/tool-input", (params) => {
      console.log("Tool input:", params);
    });

    // Render the recipe UI
    function renderRecipe() {
      if (!recipe) return;

      elements.loading.classList.add("hidden");
      elements.content.classList.remove("hidden");

      // Header
      elements.recipeIcon.textContent = recipe.icon;
      elements.recipeName.textContent = recipe.name;
      elements.recipeDescription.textContent = recipe.description;
      elements.prepTime.textContent = `${recipe.prepTime} min prep`;
      elements.cookTime.textContent = `${recipe.cookTime} min cook`;

      // Difficulty badge
      const difficultyMap = {
        easy: { label: "Easy", class: "difficulty-easy" },
        medium: { label: "Medium", class: "difficulty-medium" },
        hard: { label: "Hard", class: "difficulty-hard" },
      };
      const diff = difficultyMap[recipe.difficulty] || difficultyMap.easy;
      elements.difficultyBadge.textContent = diff.label;
      elements.difficultyBadge.className = `meta-item ${diff.class}`;

      // Tags
      elements.tagsContainer.innerHTML = recipe.tags.map(tag =>
        `<span class="tag">${tag}</span>`
      ).join("");

      // Servings
      elements.servingCount.textContent = currentServings;

      // Render ingredients and steps
      renderIngredients();
      renderSteps();
      renderNutrition();
      mcpApp.reportSize();
    }

    // Calculate adjusted amount based on servings
    function adjustAmount(amount, unit) {
      if (amount === null || amount === undefined || amount === "") return "";

      // Handle both number and string amounts
      let numAmount;
      if (typeof amount === "number") {
        numAmount = amount;
      } else if (typeof amount === "string" && amount.includes("/")) {
        // Handle fractions like "1/2"
        const parts = amount.split("/");
        numAmount = parseFloat(parts[0]) / parseFloat(parts[1]);
      } else {
        numAmount = parseFloat(amount);
      }

      if (isNaN(numAmount)) return amount;

      // Scale based on servings
      const scaled = (numAmount * currentServings) / originalServings;

      // Format nicely
      if (scaled === Math.floor(scaled)) {
        return scaled.toString();
      } else if (scaled < 1) {
        // Convert to fraction
        const fractions = [
          [0.25, "¬º"], [0.33, "‚Öì"], [0.5, "¬Ω"], [0.67, "‚Öî"], [0.75, "¬æ"]
        ];
        for (const [val, frac] of fractions) {
          if (Math.abs(scaled - val) < 0.1) return frac;
        }
      }
      return scaled.toFixed(1).replace(/\.0$/, "");
    }

    // Render ingredients list
    function renderIngredients() {
      const ingredients = recipe.ingredients || [];

      elements.ingredientsList.innerHTML = ingredients.map((ing, index) => {
        const isChecked = checkedIngredients.has(index);
        const adjustedAmount = adjustAmount(ing.amount, ing.unit);

        return `
          <div class="ingredient-item ${isChecked ? 'checked' : ''}" data-index="${index}">
            <div class="ingredient-checkbox">
              ${isChecked ? '<span class="check-animate">‚úì</span>' : ''}
            </div>
            <span class="ingredient-amount">${adjustedAmount} ${ing.unit}</span>
            <span class="ingredient-text">
              ${ing.name}
              ${ing.optional ? '<span class="optional-badge">optional</span>' : ''}
            </span>
          </div>
        `;
      }).join("");

      // Update progress
      const checked = checkedIngredients.size;
      const total = ingredients.length;
      elements.ingredientsProgress.textContent = `${checked}/${total}`;

      // Attach click handlers
      document.querySelectorAll(".ingredient-item").forEach(item => {
        item.addEventListener("click", toggleIngredient);
      });
    }

    // Toggle ingredient checked state
    function toggleIngredient(event) {
      const index = parseInt(event.currentTarget.dataset.index, 10);
      if (checkedIngredients.has(index)) {
        checkedIngredients.delete(index);
      } else {
        checkedIngredients.add(index);
      }
      renderIngredients();
    }

    // Render steps list
    function renderSteps() {
      const steps = recipe.steps || [];

      elements.stepsList.innerHTML = steps.map(step => `
        <div class="step-item">
          <div class="step-number">${step.number}</div>
          <div class="step-content">
            <p class="text-sm text-gray-700">${step.instruction}</p>
            ${step.time ? `<p class="step-time">‚è±Ô∏è ${step.time} min</p>` : ''}
          </div>
        </div>
      `).join("");
    }

    // Render nutrition panel
    function renderNutrition() {
      const nutrition = recipe.nutrition || {};
      elements.calories.textContent = nutrition.calories || 0;
      elements.protein.textContent = `${nutrition.protein || 0}g`;
      elements.carbs.textContent = `${nutrition.carbs || 0}g`;
      elements.fat.textContent = `${nutrition.fat || 0}g`;
      elements.fiber.textContent = `${nutrition.fiber || 0}g`;
    }

    // Adjust servings
    async function adjustServings(delta) {
      const newServings = Math.max(1, Math.min(12, currentServings + delta));
      if (newServings === currentServings) return;

      currentServings = newServings;
      elements.servingCount.textContent = currentServings;

      // Re-render ingredients with new amounts
      renderIngredients();
      mcpApp.reportSize();

      // Call MCP tool to get adjusted recipe
      try {
        const result = await mcpApp.sendRequest("tools/call", {
          name: "adjust-servings",
          arguments: {
            recipeId: recipe.id,
            newServings: currentServings,
          },
        });

        // Update recipe with adjusted data if available
        if (result?.structuredContent?.recipe) {
          recipe = result.structuredContent.recipe;
          renderRecipe();
        }
      } catch (error) {
        console.error("Failed to adjust servings:", error);
      }
    }

    // Event listeners for serving buttons
    elements.decreaseServings.addEventListener("click", () => adjustServings(-1));
    elements.increaseServings.addEventListener("click", () => adjustServings(1));

    // Save recipe button handler
    elements.saveRecipeBtn.addEventListener("click", async () => {
      const btn = elements.saveRecipeBtn;
      const originalText = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<span class="mr-1">‚è≥</span> Saving...';
      try {
        await mcpApp.sendRequest("ui/message", {
          role: "user",
          content: [{ type: "text", text: `Please save this recipe: ${recipe.name} üìñ` }],
        });
        btn.innerHTML = '<span class="mr-1">‚úÖ</span> Saved!';
        btn.classList.remove("btn-primary");
        btn.classList.add("bg-green-500");
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.classList.remove("bg-green-500");
          btn.classList.add("btn-primary");
          btn.disabled = false;
        }, 2000);
      } catch (error) {
        console.error("Failed to send message:", error);
        btn.innerHTML = '<span class="mr-1">‚ùå</span> Failed';
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.disabled = false;
        }, 2000);
      }
    });

    // Initialize on load
    window.addEventListener("load", initialize);
  </script>
</body>
</html>
